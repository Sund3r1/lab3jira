name: Good CI/CD (Fixed)

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-22.04
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    # ХОРОШАЯ ПРАКТИКА: Правильная установка Python
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"
        
    # ХОРОШАЯ ПРАКТИКА: Кеширование зависимостей
    - name: Cache pip packages
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
        
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        pip install pytest
        
    # ХОРОШАЯ ПРАКТИКА: Безопасное логирование
    - name: Show environment info
      env:
        TEST_MODE: ${{ secrets.TEST_MODE || 'development' }}
      run: |
        echo "Running in $TEST_MODE mode"
        echo "No secrets exposed here"
        
    # ХОРОШАЯ ПРАКТИКА: Тесты влияют на результат
    - name: Run tests
      run: |
        python -m pytest test_main.py -v
        # Если тесты упадут, workflow остановится здесь
        
    # ХОРОШАЯ ПРАКТИКА: Деплой только при успешных тестах
    - name: Deploy simulation
      if: success()
      run: |
        echo "✅ All tests passed, proceeding with deployment simulation"
        echo "Deployment would happen here..."
